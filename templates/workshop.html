<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pelican Art Gallery</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    <link rel="stylesheet" href="/static/css/main.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-nav">
          <a href="/gallery" class="nav-link">View Gallery</a>
        </div>
        <h1><a href="/" class="workshop-title-link">Pelican Art Gallery</a></h1>
      </header>

      {{if .EditData}}
      <div class="edit-banner">
        <div class="edit-banner-content">
          <span>Editing artwork: <strong>{{.EditData.Title}}</strong></span>
        </div>
      </div>
      {{end}}

      <main>
        <div class="workspace">
          <div class="panel input-panel">
            <div class="main-controls">
              <div class="form-group">
                <label for="model-selector-btn">
                  AI Models <span id="model-count" class="model-count"></span>
                </label>
                <button id="model-selector-btn" class="model-selector-btn" type="button">
                  <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
                  </svg>
                  <span class="btn-text" id="model-selector-text">Select Models</span>
                </button>
                <div id="selected-models-list" class="selected-models-list" style="display: none;">
                </div>
              </div>

              <div class="form-group">
                <label for="prompt-input">Describe your artwork</label>
                <div class="prompt-input-container">
                  <textarea
                    id="prompt-input"
                    class="form-textarea"
                    placeholder="A serene mountain landscape with geometric patterns, flowing rivers, and abstract shapes in harmonious colors..."
                    rows="6"
                  >{{if .EditData}}{{.EditData.Prompt}}{{else}}Detailed illustration of exotic flowering plants with precise linework, leaf structures, and natural colors.{{end}}</textarea>
                  <button id="examples-btn" class="examples-btn" type="button">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14,2 14,8 20,8"/>
                      <line x1="16" y1="13" x2="8" y2="13"/>
                      <line x1="16" y1="17" x2="8" y2="17"/>
                      <polyline points="10,9 9,9 8,9"/>
                    </svg>
                    Examples
                  </button>
                </div>
              </div>

                            <div class="form-group artwork-metadata">
                <div class="form-field">
                  <label for="title-input">Title</label>
                  <input
                    type="text"
                    id="title-input"
                    placeholder="Mountain Landscape"
                    title="Enter a descriptive title for your artwork"
                    {{if .EditData}}value="{{.EditData.Title}}"{{end}}
                  />
                </div>
                
                <div class="form-field">
                  <label for="category-input">Category</label>
                  <input
                    type="text"
                    id="category-input"
                    placeholder="abstract, nature, geometric, etc."
                    {{if .EditData}}value="{{.EditData.Category}}"{{end}}
                  />
                </div>
              </div>

              {{if .EditingEnabled}}
              <div class="action-controls">
                <button id="generate-btn" class="btn btn-generate" disabled>
                  <span class="btn-text">Generate</span>
                  <span class="btn-loading" style="display: none">
                    <svg class="icon spinning" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 12a9 9 0 11-6.219-8.56"/>
                    </svg>
                    Generating...
                  </span>
                </button>
                <button id="config-btn" class="btn btn-config" type="button">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09A1.65 1.65 0 0 0 9 3.09V3a2 2 0 1 1 4 0v.09c0 .66.39 1.25 1 1.51a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09c.66.26 1.25.85 1.51 1.51H21a2 2 0 1 1 0 4h-.09c-.66 0-1.25.39-1.51 1z"/>
                </svg>
                </button>
              </div>
              {{else}}
              <div class="api-key-warning">
                <div class="warning-icon">
                  <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                    <line x1="12" y1="9" x2="12" y2="13"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                  </svg>
                </div>
                <h3>OpenRouter API Key Required</h3>
                <p>To create artwork, you need to set the <code>OPENROUTER_API_KEY</code> environment variable. Please contact the administrator to configure this.</p>
              </div>
              {{end}}
            </div>
          </div>

          <div class="panel output-panel">
            <div id="svg-preview" class="svg-preview">
              <div class="placeholder">
                <div class="placeholder-icon">
                  <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21,15 16,10 5,21"/>
                  </svg>
                </div>
                <p>Generated SVGs will appear here</p>
              </div>
            </div>
          </div>
        </div>

        <div id="error-message" class="error-message" style="display: none"></div>
      </main>

      <footer>
        <p>Created by <a href="https://koenvangilst.nl" target="_blank" rel="noopener noreferrer">Koen van Gilst</a></p>
      </footer>
    </div>

    <!-- Model Selection Modal -->
    <dialog id="model-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
            </svg>
            Select AI Models
          </h2>
          <button id="close-model-btn" class="close-btn" type="button">×</button>
        </div>
        <div class="modal-body">
          <div class="model-selection-grid">
            {{range .Models}}
            <div class="card model-card" data-model-id="{{.ID}}" data-model-name="{{.Name}}">
              <div class="model-card-header">
                <input type="checkbox" 
                       id="model-{{.ID}}" 
                       value="{{.ID}}"{{if .Checked}} checked{{end}} />
                <span class="model-name">{{.Name}}</span>
              </div>
              <div class="model-description">
                <div class="model-id">{{.ID}}</div>
                <div class="model-cost">${{printf "%.3f" .Cost}}/1M tokens</div>
              </div>
            </div>
            {{end}}
          </div>
          
          <div class="modal-actions">
            <button id="clear-models-btn" class="btn btn-secondary">Clear All</button>
            <button id="select-all-models-btn" class="btn btn-secondary">Select All</button>
            <button id="save-models-btn" class="btn btn-primary">Save Selection</button>
          </div>
        </div>
      </div>
    </dialog>

    <!-- Examples Modal -->
    <dialog id="examples-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
            Prompt Examples
          </h2>
          <button id="close-examples-btn" class="close-btn" type="button">×</button>
        </div>
        <div class="modal-body">
          <div class="examples-grid" id="examples-grid">
            {{range .Examples}}
            <div class="example-card" data-prompt="{{.Prompt}}" data-title="{{.Title}}" data-category="{{.Category}}">
              <div class="example-title">{{.Title}}</div>
              <div class="example-prompt">{{.Prompt}}</div>
            </div>
            {{end}}
          </div>
        </div>
      </div>
    </dialog>

    <!-- Configuration Modal -->
    <dialog id="config-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>
            Generation Settings
          </h2>
          <button id="close-config-btn" class="close-btn" type="button">×</button>
        </div>
        <div class="modal-body">
          <div class="config-grid">
            <div class="config-section">
              <h3>Model Parameters</h3>
              
              <div class="form-group">
                <label for="temperature-input">
                  Temperature
                  <span class="parameter-info">Controls creativity (0 = focused, 2 = creative)</span>
                </label>
                <div class="slider-container">
                  <input type="range" id="temperature-input" min="0" max="2" step="0.1" value="{{.DefaultTemp}}" />
                  <span class="slider-value" id="temperature-value">{{.DefaultTemp}}</span>
                </div>
              </div>

              <div class="form-group">
                <label for="max-tokens-input">
                  Max Tokens
                  <span class="parameter-info">Maximum response length</span>
                </label>
                <div class="slider-container">
                  <input type="range" id="max-tokens-input" min="100" max="1000000" step="100" value="{{.DefaultMaxTokens}}" />
                  <span class="slider-value" id="max-tokens-value">{{.DefaultMaxTokens}}</span>
                </div>
              </div>
            </div>

            <div class="config-section">
              <h3>Advanced Options</h3>
              
              <div class="form-group reasoning-group" id="reasoning-group">
                <label class="checkbox-label">
                  <input type="checkbox" class="form-checkbox" id="reasoning-enabled"{{if .ReasoningEnabled}} checked{{end}} />
                  <span class="checkmark"></span>
                  Enable Advanced Reasoning
                  <span class="parameter-info">Use enhanced reasoning for complex prompts</span>
                </label>

                <div id="reasoning-options"{{if not .ReasoningEnabled}} style="display: none"{{end}}>
                  <div class="form-subgroup">
                    <label for="reasoning-effort">Reasoning Effort</label>
                    <select id="reasoning-effort">
                      <option value="low"{{if eq .ReasoningEffort "low"}} selected{{end}}>Low</option>
                      <option value="medium"{{if eq .ReasoningEffort "medium"}} selected{{end}}>Medium</option>
                      <option value="high"{{if eq .ReasoningEffort "high"}} selected{{end}}>High</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="modal-actions">
            <button id="reset-config-btn" class="secondary-btn">Reset to Defaults</button>
            <button id="save-config-btn" class="primary-btn">Save Settings</button>
          </div>
        </div>
      </div>
    </dialog>

    <script>
      // Make existing artworks data available to JavaScript
      {{if .EditArtworks}}
      window.existingArtworks = {{.EditArtworks | json}};
      {{else}}
      window.existingArtworks = [];
      {{end}}
    </script>
    <script type="module" src="/static/js/main.js"></script>
  </body>
</html>
